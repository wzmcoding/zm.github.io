import{_ as c}from"./ValaxyMain.vue_vue_type_style_index_0_lang.DdUUqTrc.js";import{d as g,a as y,u as o}from"./chunks/vue-router.C6YDt_2k.js";import{a6 as F,a7 as l,a8 as n,a9 as s,aa as i,A as u,a5 as A,H as C}from"./framework.A6mPAibL.js";import"./app.Bo7xXc2P.js";import"./chunks/dayjs.BmWuu2Zz.js";import"./chunks/@vueuse/motion.D2ANLWtK.js";import"./chunks/pinia.io1aU5oy.js";import"./chunks/vue-i18n.DMnAg64a.js";/* empty css                    */import"./chunks/nprogress.OjJGPx9O.js";import"./YunComment.vue_vue_type_style_index_0_lang.tcwUchWq.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.CWxh2StM.js";import"./post.D_tAr-8X.js";const m=g("/posts/component14",async h=>JSON.parse('{"title":"KeepAlive 组件实现原理","description":"","frontmatter":{"title":"KeepAlive 组件实现原理","date":"2025-09-30","updated":"2025-09-30","categories":"手写Vue3源码之组件篇","tags":["手写Vue3源码之组件篇"],"top":1},"headers":[],"relativePath":"pages/posts/component14/index.md","lastUpdated":1770565897000}'),{lazy:(h,t)=>h.name===t.name}),M={__name:"index",setup(h,{expose:t}){const{data:k}=m(),r=o(),E=y(),e=Object.assign(E.meta.frontmatter||{},k.value?.frontmatter||{});return r.currentRoute.value.data=k.value,C("valaxy:frontmatter",e),globalThis.$frontmatter=e,t({frontmatter:{title:"KeepAlive 组件实现原理",date:"2025-09-30",updated:"2025-09-30",categories:"手写Vue3源码之组件篇",tags:["手写Vue3源码之组件篇"],top:1}}),(a,p)=>{const d=c;return A(),F(d,{frontmatter:u(e)},{"main-content-md":l(()=>[...p[0]||(p[0]=[s("h2",{id:"keepalive-组件实现原理",tabindex:"-1"},[i("KeepAlive 组件实现原理 "),s("a",{class:"header-anchor",href:"#keepalive-组件实现原理","aria-label":'Permalink to "KeepAlive 组件实现原理"'},"​")],-1),s("p",null,"KeepAlive 是 Vue3 中一个内置组件，用于缓存组件实例和 DOM，以提高组件切换的性能。本文将深入分析 KeepAlive 组件的实现原理。",-1),s("h2",{id:"_1-基本概念",tabindex:"-1"},[i("1. 基本概念 "),s("a",{class:"header-anchor",href:"#_1-基本概念","aria-label":'Permalink to "1. 基本概念"'},"​")],-1),s("p",null,"KeepAlive 组件主要用于解决以下场景：",-1),s("ul",null,[s("li",null,"在组件切换时保持组件状态，避免重复创建和销毁"),s("li",null,"优化性能，减少不必要的组件重渲染"),s("li",null,"保持组件中的用户输入、滚动位置等状态")],-1),s("h2",{id:"_2-核心实现",tabindex:"-1"},[i("2. 核心实现 "),s("a",{class:"header-anchor",href:"#_2-核心实现","aria-label":'Permalink to "2. 核心实现"'},"​")],-1),s("h3",{id:"_2-1-组件定义",tabindex:"-1"},[i("2.1 组件定义 "),s("a",{class:"header-anchor",href:"#_2-1-组件定义","aria-label":'Permalink to "2.1 组件定义"'},"​")],-1),s("div",{class:"language-javascript"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"javascript"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"export"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," KeepAlive"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  name: "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'KeepAlive'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  __isKeepAlive: "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  props: ["),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'max'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"],")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  setup"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"props"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", { "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"slots"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," }) {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," instance"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," getCurrentInstance"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," cache"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," LRUCache"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(props.max)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," storageContainer"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," createElement"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'div'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},")")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // ... 实现逻辑")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  },")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"主要特点：",-1),s("ul",null,[s("li",null,[i("使用 "),s("code",null,"__isKeepAlive"),i(" 标识符标记组件类型")]),s("li",null,[i("支持 "),s("code",null,"max"),i(" 属性限制缓存数量")]),s("li",null,[i("使用 "),s("code",null,"LRU"),i("（最近最少使用）算法管理缓存")])],-1),s("h3",{id:"_2-2-缓存机制",tabindex:"-1"},[i("2.2 缓存机制 "),s("a",{class:"header-anchor",href:"#_2-2-缓存机制","aria-label":'Permalink to "2.2 缓存机制"'},"​")],-1),s("p",null,"KeepAlive 使用 LRU（Least Recently Used）算法实现缓存管理：",-1),s("div",{class:"language-javascript"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"javascript"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"class"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," LRUCache"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"  cache"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Map"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"  max")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  constructor"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"max"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," Infinity"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".max "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," max")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  get"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"key"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"!"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".cache."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"has"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key)) "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"return")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 获取缓存时，将项移到最新位置")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," value"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".cache."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".cache."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"delete"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".cache."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"set"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, value)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    return"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," value")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  set"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"key"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"value"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".cache."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"has"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key)) {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"      this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".cache."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"delete"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    } "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"else"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".cache.size "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},">="),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".max) {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"      // 缓存满时，删除最久未使用的项")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"      const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," firstKey"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".cache."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"keys"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"next"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"().value")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"      const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," vnode"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".cache."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"get"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(firstKey)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"      this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".cache."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"delete"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(firstKey)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"      return"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," vnode "),s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 返回被删除的节点用于清理")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"    this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},".cache."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"set"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(key, value)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"缓存策略：",-1),s("ol",null,[s("li",null,"使用 Map 数据结构存储缓存项"),s("li",null,"每次访问缓存项时，将其移到最新位置"),s("li",null,"缓存满时，删除最久未使用的项")],-1),s("p",null,"举例说明 LRU 缓存的工作原理：",-1),s("p",null,[i("假设我们设置 "),s("code",null,'max="2"'),i("，有三个组件 A、B、C：")],-1),s("div",{class:"language-text"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"text"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",null,"初始状态：[]（空缓存）")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"1. 访问组件A：")]),i(`
`),s("span",{class:"line"},[s("span",null,"   缓存状态：[A]")]),i(`
`),s("span",{class:"line"},[s("span",null,"   操作：将A添加到缓存")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"2. 访问组件B：")]),i(`
`),s("span",{class:"line"},[s("span",null,"   缓存状态：[A, B]")]),i(`
`),s("span",{class:"line"},[s("span",null,"   操作：将B添加到缓存")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"3. 访问组件C：")]),i(`
`),s("span",{class:"line"},[s("span",null,"   缓存状态：[B, C]")]),i(`
`),s("span",{class:"line"},[s("span",null,"   操作：")]),i(`
`),s("span",{class:"line"},[s("span",null,"   - 缓存已满（max=2）")]),i(`
`),s("span",{class:"line"},[s("span",null,"   - 删除最久未使用的A")]),i(`
`),s("span",{class:"line"},[s("span",null,"   - 将C添加到缓存")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"4. 再次访问组件B：")]),i(`
`),s("span",{class:"line"},[s("span",null,"   缓存状态：[C, B]")]),i(`
`),s("span",{class:"line"},[s("span",null,"   操作：")]),i(`
`),s("span",{class:"line"},[s("span",null,"   - B已在缓存中")]),i(`
`),s("span",{class:"line"},[s("span",null,"   - 将B移到最新位置")]),i(`
`),s("span",{class:"line"},[s("span")]),i(`
`),s("span",{class:"line"},[s("span",null,"5. 访问组件A：")]),i(`
`),s("span",{class:"line"},[s("span",null,"   缓存状态：[B, A]")]),i(`
`),s("span",{class:"line"},[s("span",null,"   操作：")]),i(`
`),s("span",{class:"line"},[s("span",null,"   - 缓存已满（max=2）")]),i(`
`),s("span",{class:"line"},[s("span",null,"   - 删除最久未使用的C")]),i(`
`),s("span",{class:"line"},[s("span",null,"   - 将A添加到缓存")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"这个过程展示了 LRU 缓存的核心特性：",-1),s("ul",null,[s("li",null,[i("有限的缓存空间（"),s("code",null,"max=2"),i("）")]),s("li",null,"最近使用的组件被保留"),s("li",null,"最久未使用的组件被淘汰"),s("li",null,"访问已缓存组件会更新其位置")],-1),s("h3",{id:"_2-3-组件激活-停用",tabindex:"-1"},[i("2.3 组件激活/停用 "),s("a",{class:"header-anchor",href:"#_2-3-组件激活-停用","aria-label":'Permalink to "2.3 组件激活/停用"'},"​")],-1),s("p",null,"KeepAlive 通过特殊的 ShapeFlags 标记来控制组件的生命周期：",-1),s("div",{class:"language-javascript"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"javascript"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 标记需要被缓存的组件")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"vnode.shapeFlag "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ShapeFlags."),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"COMPONENT_SHOULD_KEEP_ALIVE")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 标记已经被缓存的组件")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"vnode.shapeFlag "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ShapeFlags."),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"COMPONENT_KEPT_ALIVE")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"处理流程：",-1),s("ol",null,[s("li",null,"组件首次渲染：")],-1),s("div",{class:"language-javascript"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"javascript"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (cachedVNode) {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // 复用缓存的组件实例和 DOM")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  vnode.component "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cachedVNode.component")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  vnode.el "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," cachedVNode.el")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  vnode.shapeFlag "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"|="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ShapeFlags."),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"COMPONENT_KEPT_ALIVE")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("ol",{start:"2"},[s("li",null,"组件停用时：")],-1),s("ul",null,[s("li",null,"将组件 DOM 移动到隐藏容器"),s("li",null,"保持组件实例和状态"),s("li",null,"不触发组件的 unmount 生命周期")],-1),s("ol",{start:"3"},[s("li",null,"组件重新激活：")],-1),s("div",{class:"language-javascript"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"javascript"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"instance.ctx."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"activate"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"vnode"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"container"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"anchor"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"  insert"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(vnode.el, container, anchor)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"_3-渲染器集成",tabindex:"-1"},[i("3. 渲染器集成 "),s("a",{class:"header-anchor",href:"#_3-渲染器集成","aria-label":'Permalink to "3. 渲染器集成"'},"​")],-1),s("p",null,"在 Vue3 的渲染器中，对 KeepAlive 组件有特殊处理：",-1),s("div",{class:"language-javascript"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"javascript"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"const"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," processComponent"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"n1"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"n2"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"container"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"anchor"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"parentComponent"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=>"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n1 "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"=="),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," null"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"    if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (n2.shapeFlag "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"&"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ShapeFlags."),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"COMPONENT_KEPT_ALIVE"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"      // 激活缓存的组件")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      parentComponent.ctx."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"activate"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(n2, container, anchor)")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"      return")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"    // 正常挂载流程...")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"特点：",-1),s("ul",null,[s("li",null,"检测组件是否被 KeepAlive 缓存"),s("li",null,"对缓存的组件使用特殊的激活流程"),s("li",null,"维护组件的缓存状态")],-1),s("h2",{id:"_4-实现优势",tabindex:"-1"},[i("4. 实现优势 "),s("a",{class:"header-anchor",href:"#_4-实现优势","aria-label":'Permalink to "4. 实现优势"'},"​")],-1),s("ol",null,[s("li",null,"性能优化")],-1),s("ul",null,[s("li",null,"避免重复创建组件实例"),s("li",null,"复用 DOM 结构"),s("li",null,"保持组件状态")],-1),s("ol",{start:"2"},[s("li",null,"灵活性")],-1),s("ul",null,[s("li",null,"支持最大缓存数量限制"),s("li",null,"智能的缓存淘汰策略"),s("li",null,"可以和 Transition 等其他功能组合使用")],-1),s("h2",{id:"_5-使用场景",tabindex:"-1"},[i("5. 使用场景 "),s("a",{class:"header-anchor",href:"#_5-使用场景","aria-label":'Permalink to "5. 使用场景"'},"​")],-1),s("p",null,"KeepAlive 组件最适合用于：",-1),s("ol",null,[s("li",null,"标签页切换"),s("li",null,"表单向导"),s("li",null,"列表详情切换"),s("li",null,"需要保持组件状态的场景")],-1),s("h2",{id:"_6-注意事项",tabindex:"-1"},[i("6. 注意事项 "),s("a",{class:"header-anchor",href:"#_6-注意事项","aria-label":'Permalink to "6. 注意事项"'},"​")],-1),s("ol",null,[s("li",null,"合理设置 max 缓存数量，避免内存占用过大"),s("li",null,"被缓存组件的生命周期会有所不同"),s("li",null,"需要注意缓存组件的内存释放"),s("li",null,"不是所有组件都适合被缓存")],-1),s("h2",{id:"总结",tabindex:"-1"},[i("总结 "),s("a",{class:"header-anchor",href:"#总结","aria-label":'Permalink to "总结"'},"​")],-1),s("p",null,[i("Vue3 的 "),s("code",null,"KeepAlive"),i(" 组件通过 "),s("code",null,"LRU"),i(" 缓存算法和特殊的组件生命周期控制，实现了高效的组件缓存机制。 它通过在组件实例和 DOM 层面的复用，显著提升了组件切换的性能，同时保持了良好的内存管理。 这使得开发者可以在需要保持组件状态的场景中获得更好的用户体验。")],-1)])]),"main-header":l(()=>[n(a.$slots,"main-header")]),"main-header-after":l(()=>[n(a.$slots,"main-header-after")]),"main-nav":l(()=>[n(a.$slots,"main-nav")]),"main-content-before":l(()=>[n(a.$slots,"main-content-before")]),"main-content":l(()=>[n(a.$slots,"main-content")]),"main-content-after":l(()=>[n(a.$slots,"main-content-after")]),"main-nav-before":l(()=>[n(a.$slots,"main-nav-before")]),"main-nav-after":l(()=>[n(a.$slots,"main-nav-after")]),comment:l(()=>[n(a.$slots,"comment")]),footer:l(()=>[n(a.$slots,"footer")]),aside:l(()=>[n(a.$slots,"aside")]),"aside-custom":l(()=>[n(a.$slots,"aside-custom")]),default:l(()=>[n(a.$slots,"default")]),_:3},8,["frontmatter"])}}};export{M as default,m as usePageData};
