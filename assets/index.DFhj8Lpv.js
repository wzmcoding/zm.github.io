import{_ as o}from"./ValaxyMain.vue_vue_type_style_index_0_lang.D2x3T085.js";import"./chunks/@vueuse/motion.BcEIw0NR.js";import{d as g,a as c,u as y}from"./chunks/vue-router.CZk76H6s.js";import{a5 as F,a7 as l,a8 as t,a9 as s,aa as i,P as u,a6 as C,a1 as b}from"./framework.CG9Os-4p.js";import"./app.8_qfBJaY.js";import"./chunks/dayjs.BsdSHi3w.js";import"./chunks/pinia.C6T_96Gc.js";import"./chunks/vue-i18n.z_u8KU1V.js";/* empty css                    */import"./chunks/nprogress.Cm54BOVh.js";import"./YunComment.vue_vue_type_style_index_0_lang.COtyFPRy.js";import"./index.C5okkQwF.js";import"./YunPageHeader.vue_vue_type_script_setup_true_lang.C1Brb18r.js";import"./post.DGbGYUXc.js";const m=g("/posts/sse",async e=>JSON.parse('{"title":"SSE原理","description":"","frontmatter":{"title":"SSE原理","date":"2025-08-15","updated":"2025-08-15","categories":"work-summary","tags":["work-summary"],"top":1},"headers":[],"relativePath":"pages/posts/sse/index.md","lastUpdated":1760680509000}'),{lazy:(e,h)=>e.name===h.name}),q={__name:"index",setup(e,{expose:h}){const{data:k}=m(),d=y(),r=c(),n=Object.assign(r.meta.frontmatter||{},k.value?.frontmatter||{});return d.currentRoute.value.data=k.value,b("valaxy:frontmatter",n),globalThis.$frontmatter=n,h({frontmatter:{title:"SSE原理",date:"2025-08-15",updated:"2025-08-15",categories:"work-summary",tags:["work-summary"],top:1}}),(a,E)=>{const p=o;return C(),F(p,{frontmatter:u(n)},{"main-content-md":l(()=>[...E[0]||(E[0]=[s("p",null,[i("服务器向浏览器推送信息，除了 "),s("code",null,"WebSocket"),i("，还有一种方法："),s("code",null,"Server-Sent Events"),i("（以下简称 "),s("code",null,"SSE"),i("）。 "),s("img",{src:"https://www.ruanyifeng.com/blogimg/asset/2017/bg2017052701.png",alt:"image.png"})],-1),s("h1",{id:"_1-sse的本质",tabindex:"-1"},[i("1. SSE的本质 "),s("a",{class:"header-anchor",href:"#_1-sse的本质","aria-label":'Permalink to "1. SSE的本质"'},"​")],-1),s("p",null,[i("严格地说，"),s("code",null,"HTTP"),i(" 协议无法做到服务器主动推送信息。但是，有一种变通方法，就是服务器向客户端声明，接下来要发送的是"),s("strong",null,"流信息"),i("（"),s("code",null,"streaming"),i("）。")],-1),s("p",null,[i("也就是说，发送的不是一次性的数据包，而是一个"),s("code",null,"数据流"),i("，会连续不断地发送过来。 这时，客户端不会关闭连接，会一直等着服务器发过来的新的数据流，视频播放就是这样的例子。"),s("strong",null,"本质上，这种通信就是以流信息的方式，完成一次用时很长的下载。")],-1),s("p",null,[s("code",null,"SSE"),i(" 就是利用这种机制，使用流信息向浏览器推送信息。它基于 "),s("code",null,"HTTP"),i(" 协议.")],-1),s("h1",{id:"_2-sse的特点",tabindex:"-1"},[i("2. SSE的特点 "),s("a",{class:"header-anchor",href:"#_2-sse的特点","aria-label":'Permalink to "2. SSE的特点"'},"​")],-1),s("p",null,[s("code",null,"SSE"),i(" 与 "),s("code",null,"WebSocket"),i(" 作用相似，都是建立浏览器与服务器之间的通信渠道，然后服务器向浏览器推送信息。")],-1),s("p",null,[i("总体来说，"),s("code",null,"WebSocket"),i(" 更强大和灵活。因为它是全双工通道，可以双向通信；"),s("code",null,"SSE"),i(" 是"),s("strong",null,"单向通道"),i("，只能服务器向浏览器发送，因为"),s("strong",null,"流信息本质上就是下载"),i("。 如果浏览器向服务器发送信息，就变成了另一次 "),s("code",null,"HTTP"),i(" 请求。")],-1),s("figure",null,[s("img",{src:"https://www.ruanyifeng.com/blogimg/asset/2017/bg2017052702.jpg",alt:"image.png",loading:"lazy",decoding:"async"})],-1),s("h2",{id:"sse的优点",tabindex:"-1"},[i("SSE的优点: "),s("a",{class:"header-anchor",href:"#sse的优点","aria-label":'Permalink to "SSE的优点:"'},"​")],-1),s("blockquote",null,[s("ul",null,[s("li",null,[s("code",null,"SSE"),i(" 使用 "),s("code",null,"HTTP"),i(" 协议，现有的服务器软件都支持。"),s("code",null,"WebSocket"),i(" 是一个独立协议。")]),s("li",null,[s("code",null,"SSE"),i(" 属于轻量级，使用简单；"),s("code",null,"WebSocket"),i(" 协议相对复杂。")]),s("li",null,[s("code",null,"SSE"),i(" 默认支持断线重连，"),s("code",null,"WebSocket"),i(" 需要自己实现。")]),s("li",null,[s("code",null,"SSE"),i(" 一般只用来传送文本，二进制数据需要编码后传送，"),s("code",null,"WebSocket"),i(" 默认支持传送二进制数据。")]),s("li",null,[s("code",null,"SSE"),i(" 支持自定义发送的消息类型。")])])],-1),s("h1",{id:"_3-客户端-api",tabindex:"-1"},[i("3. 客户端 API "),s("a",{class:"header-anchor",href:"#_3-客户端-api","aria-label":'Permalink to "3. 客户端 API"'},"​")],-1),s("h2",{id:"eventsource-对象",tabindex:"-1"},[i("EventSource 对象 "),s("a",{class:"header-anchor",href:"#eventsource-对象","aria-label":'Permalink to "EventSource 对象"'},"​")],-1),s("p",null,[s("code",null,"SSE"),i(" 的客户端 API 部署在"),s("code",null,"EventSource"),i("对象上。下面的代码可以检测浏览器是否支持 "),s("code",null,"SSE"),i("。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'EventSource'"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," in"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," window) {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // ...")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("使用 "),s("code",null,"SSE"),i(" 时,浏览器首先生成一个"),s("code",null,"EventSource"),i("实例,向服务器发起连接.")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," source"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," EventSource"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(url);")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("上面的"),s("code",null,"url"),i("可以与当前网址同域,也可以跨域.跨域时,可以指定第二个参数,打开"),s("code",null,"withCredentials"),i("属性,表示是否一起发送 "),s("code",null,"Cookie"),i(".")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," source"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," new"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," EventSource"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(url, { withCredentials: "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"true"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," });")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[s("code",null,"EventSource"),i("实例的"),s("code",null,"readyState"),i("属性,表明连接的当前状态.该属性只读,可以取以下值.")],-1),s("blockquote",null,[s("ul",null,[s("li",null,[i("0：相当于常量"),s("code",null,"EventSource.CONNECTING"),i("，表示连接还未建立，或者断线正在重连。")]),s("li",null,[i("1：相当于常量"),s("code",null,"EventSource.OPEN"),i("，表示连接已经建立，可以接受数据。")]),s("li",null,[i("2：相当于常量"),s("code",null,"EventSource.CLOSED"),i("，表示连接已断，且不会重连。")])])],-1),s("h2",{id:"基本用法",tabindex:"-1"},[i("基本用法 "),s("a",{class:"header-anchor",href:"#基本用法","aria-label":'Permalink to "基本用法"'},"​")],-1),s("p",null,[i("连接一旦建立，就会触发"),s("code",null,"open"),i("事件，可以在"),s("code",null,"onopen"),i("属性定义回调函数。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"source."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"onopen"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // ...")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"};")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 另一种写法")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"source."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addEventListener"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'open'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // ...")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}, "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("客户端收到服务器发来的数据，就会触发"),s("code",null,"message"),i("事件，可以在"),s("code",null,"onmessage"),i("属性的回调函数。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"source."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"onmessage"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," data"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," event.data;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // handle message")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"};")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 另一种写法")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"source."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addEventListener"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'message'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," data"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," event.data;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // handle message")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}, "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("上面代码中，事件对象的"),s("code",null,"data"),i("属性就是服务器端传回的数据（文本格式）。")],-1),s("p",null,[i("如果发生通信错误（比如连接中断），就会触发"),s("code",null,"error"),i("事件，可以在"),s("code",null,"onerror"),i("属性定义回调函数。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"source."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"onerror"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // handle error event")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"};")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"// 另一种写法")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"source."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addEventListener"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'error'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // handle error event")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}, "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[s("code",null,"close"),i("方法用于关闭 "),s("code",null,"SSE"),i(" 连接。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"source."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"close"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"();")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"自定义事件",tabindex:"-1"},[i("自定义事件 "),s("a",{class:"header-anchor",href:"#自定义事件","aria-label":'Permalink to "自定义事件"'},"​")],-1),s("p",null,[i("默认情况下，服务器发来的数据，总是触发浏览器"),s("code",null,"EventSource"),i("实例的"),s("code",null,"message"),i("事件。开发者还可以自定义 "),s("code",null,"SSE"),i(" 事件，这种情况下，发送回来的数据不会触发"),s("code",null,"message"),i("事件。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"source."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addEventListener"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'foo'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," data"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," event.data;")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6A737D","--shiki-dark":"#6A737D"}},"  // handle message")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}, "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h1",{id:"_4-服务器实现",tabindex:"-1"},[i("4. 服务器实现 "),s("a",{class:"header-anchor",href:"#_4-服务器实现","aria-label":'Permalink to "4. 服务器实现"'},"​")],-1),s("h2",{id:"数据格式",tabindex:"-1"},[i("数据格式 "),s("a",{class:"header-anchor",href:"#数据格式","aria-label":'Permalink to "数据格式"'},"​")],-1),s("p",null,[i("服务器向浏览器发送的 "),s("code",null,"SSE"),i(" 数据，必须是 "),s("code",null,"UTF-8"),i(" 编码的文本，具有如下的 "),s("code",null,"HTTP"),i(" 头信息。")],-1),s("blockquote",null,[s("ul",null,[s("li",null,"Content-Type: text/event-stream"),s("li",null,"Cache-Control: no-cache"),s("li",null,"Connection: keep-alive")])],-1),s("p",null,[i("上面三行之中，第一行的"),s("code",null,"Content-Type"),i("必须指定 "),s("code",null,"MIME"),i(" 类型为"),s("code",null,"event-stream"),i("。")],-1),s("p",null,[i("每一次发送的信息，由若干个"),s("code",null,"message"),i("组成，每个"),s("code",null,"message"),i("之间用"),s("code",null,"\\n\\n"),i("分隔。每个"),s("code",null,"message"),i("内部由若干行组成，每一行都是如下格式。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"[field]: value\\n")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("上面的"),s("code",null,"field"),i("可以取四个值。")],-1),s("blockquote",null,[s("ul",null,[s("li",null,"data"),s("li",null,"event"),s("li",null,"id"),s("li",null,"retry")])],-1),s("p",null,"此外，还可以有冒号开头的行，表示注释。通常，服务器每隔一段时间就会向浏览器发送一个注释，保持连接不中断。",-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": This is a comment")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"下面是一个例子。",-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"this"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," is a test stream\\n\\n")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": some text\\n\\n")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": another message\\n")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"with"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," two lines \\n\\n")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"data-字段",tabindex:"-1"},[i("data 字段 "),s("a",{class:"header-anchor",href:"#data-字段","aria-label":'Permalink to "data 字段"'},"​")],-1),s("p",null,[i("数据内容用"),s("code",null,"data"),i("字段表示。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":  message\\n\\n")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("如果数据很长，可以分成多行，最后一行用"),s("code",null,"\\n\\n"),i("结尾，前面行都用"),s("code",null,"\\n"),i("结尾。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": begin message\\n")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"continue"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," message"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"\\n\\n")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("下面是一个发送 "),s("code",null,"JSON"),i(" 数据的例子。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": {\\n")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"foo"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"bar"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",\\n")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"baz"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"555"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"\\n")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": }\\n\\n")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"id-字段",tabindex:"-1"},[i("id 字段 "),s("a",{class:"header-anchor",href:"#id-字段","aria-label":'Permalink to "id 字段"'},"​")],-1),s("p",null,[i("数据标识符用"),s("code",null,"id"),i("字段表示，相当于每一条数据的编号。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"id"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": msg1\\n")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": message\\n\\n")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("浏览器用"),s("code",null,"lastEventId"),i("属性读取这个值。一旦连接断线，浏览器会发送一个 "),s("code",null,"HTTP"),i(" 头，里面包含一个特殊的"),s("code",null,"Last-Event-ID"),i("头信息， 将这个值发送回来，用来帮助服务器端重建连接。因此，这个头信息可以被视为一种同步机制。")],-1),s("h2",{id:"event-字段",tabindex:"-1"},[i("event 字段 "),s("a",{class:"header-anchor",href:"#event-字段","aria-label":'Permalink to "event 字段"'},"​")],-1),s("p",null,[s("code",null,"event"),i("字段表示自定义的事件类型，默认是"),s("code",null,"message"),i("事件。浏览器可以用"),s("code",null,"addEventListener()"),i("监听该事件。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": foo\\n")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": a foo event\\n\\n")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": an unnamed event\\n\\n")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": bar\\n")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": a bar event\\n\\n")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,[i("上面的代码创造了三条信息。第一条的名字是"),s("code",null,"foo"),i("，触发浏览器的"),s("code",null,"foo"),i("事件；第二条未取名，表示默认类型，触发浏览器的"),s("code",null,"message"),i("事件；第三条是"),s("code",null,"bar"),i("，触发浏览器的"),s("code",null,"bar"),i("事件。")],-1),s("p",null,"下面是另一个例子。",-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": userconnect")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": {"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"username"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"bobby"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"time"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"02:33:48"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": usermessage")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": {"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"username"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"bobby"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"time"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"02:34:11"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"text"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Hi everyone."'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": userdisconnect")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": {"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"username"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"bobby"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"time"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"02:34:23"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"event"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": usermessage")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"data"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": {"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"username"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"sean"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"time"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"02:34:36"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"text"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"Bye, bobby."'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"}")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("h2",{id:"retry-字段",tabindex:"-1"},[i("retry 字段 "),s("a",{class:"header-anchor",href:"#retry-字段","aria-label":'Permalink to "retry 字段"'},"​")],-1),s("p",null,[i("服务器可以用"),s("code",null,"retry"),i("字段，指定浏览器重新发起连接的时间间隔。")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"retry"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"10000"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"\\n")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("p",null,"两种情况会导致浏览器重新发起连接：一种是时间间隔到期，二是由于网络错误等原因，导致连接出错。",-1),s("h1",{id:"_5-node-服务器实例",tabindex:"-1"},[i("5. Node 服务器实例 "),s("a",{class:"header-anchor",href:"#_5-node-服务器实例","aria-label":'Permalink to "5. Node 服务器实例"'},"​")],-1),s("p",null,[s("code",null,"SSE"),i(" 要求服务器与浏览器保持连接。对于不同的服务器软件来说，所消耗的资源是不一样的。"),s("code",null,"Apache"),i(" 服务器，每个连接就是一个线程， 如果要维持大量连接，势必要消耗大量资源。"),s("code",null,"Node"),i(" 则是所有连接都使用同一个线程，因此消耗的资源会小得多， 但是这要求每个连接不能包含很耗时的操作，比如磁盘的 "),s("code",null,"IO"),i(" 读写。")],-1),s("p",null,[i("下面是 "),s("code",null,"Node"),i(" 的 "),s("code",null,"SSE"),i(" 服务器实例。 文件 "),s("code",null,"server.js")],-1),s("div",{class:"language-js"},[s("button",{title:"Copy code",class:"copy"}),s("span",{class:"lang"},"js"),s("pre",{class:"shiki shiki-themes github-light github-dark vp-code"},[s("code",{"v-pre":""},[s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," http"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," require"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"http"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"http."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"createServer"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"req"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#E36209","--shiki-dark":"#FFAB70"}},"res"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  const"),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}}," fileName"),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," ="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "."'),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," req.url;")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"  if"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," (fileName "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"==="),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "./stream"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},") {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    res."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"writeHead"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"200"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'      "Content-Type"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"text/event-stream"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'      "Cache-Control"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"no-cache"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'      "Connection"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},":"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"keep-alive"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'      "Access-Control-Allow-Origin"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},": "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},"'*'"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},",")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    });")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    res."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"write"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"retry: 10000'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    res."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"write"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"event: connecttime'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    res."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"write"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"data: "'),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Date"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n\\n"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    res."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"write"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"data: "'),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Date"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n\\n"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    interval "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"="),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," setInterval"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," () {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"      res."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"write"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"data: "'),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}}," +"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," ("),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"new"),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}}," Date"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"()) "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"+"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},' "'),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"\\n\\n"),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }, "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"1000"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"}),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    req.connection."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"addListener"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"close"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#D73A49","--shiki-dark":"#F97583"}},"function"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}}," () {")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"      clearInterval"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"(interval);")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"    }, "),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"false"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"  }")]),i(`
`),s("span",{class:"line"},[s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"})."),s("span",{style:{"--shiki-light":"#6F42C1","--shiki-dark":"#B392F0"}},"listen"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},"("),s("span",{style:{"--shiki-light":"#005CC5","--shiki-dark":"#79B8FF"}},"8844"),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},", "),s("span",{style:{"--shiki-light":"#032F62","--shiki-dark":"#9ECBFF"}},'"127.0.0.1"'),s("span",{style:{"--shiki-light":"#24292E","--shiki-dark":"#E1E4E8"}},");")])])]),s("button",{class:"code-block-unfold-btn"})],-1),s("blockquote",null,[s("p",null,"node server.js")],-1),s("p",null,[i("上面的命令会在本机的"),s("code",null,"8844"),i("端口，打开一个 "),s("code",null,"HTTP"),i(" 服务。")],-1),s("p",null,"然后，打开这个网页，查看客户端代码并运行。",-1)])]),"main-header":l(()=>[t(a.$slots,"main-header")]),"main-header-after":l(()=>[t(a.$slots,"main-header-after")]),"main-nav":l(()=>[t(a.$slots,"main-nav")]),"main-content-before":l(()=>[t(a.$slots,"main-content-before")]),"main-content":l(()=>[t(a.$slots,"main-content")]),"main-content-after":l(()=>[t(a.$slots,"main-content-after")]),"main-nav-before":l(()=>[t(a.$slots,"main-nav-before")]),"main-nav-after":l(()=>[t(a.$slots,"main-nav-after")]),comment:l(()=>[t(a.$slots,"comment")]),footer:l(()=>[t(a.$slots,"footer")]),aside:l(()=>[t(a.$slots,"aside")]),"aside-custom":l(()=>[t(a.$slots,"aside-custom")]),default:l(()=>[t(a.$slots,"default")]),_:3},8,["frontmatter"])}}};export{q as default,m as usePageData};
